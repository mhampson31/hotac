{% extends 'base.html' %}

{% load xwf_extras %}

{% block content %}

<div class="row">
    <div class="col">
        <p>Player: {{pilot.user}}</p>
        <p>Callsign: {{pilot.callsign}}</p>
        <p>Campaign: <a href="{% url 'campaign' pilot.campaign.id %}">{{pilot.campaign}}</a></p>
        <p>Missions Flown: {{missions}}</p>
    </div>
    <div class="col">
        <div class="col">XP Earned: {{pilot.total_xp}}</div>
        <div class="col">XP Available: {{remaining}}</div>
    </div>
</div>

<div class="row mb-3">
    <div class="col">
        <h4>Upgrades</h4>
            {% regroup pilot.upgrades.all by get_type_display as upgrade_list %}
            {% for upgrade_type, upgrades in upgrade_list %}
        <div class="row">
            <ul class="list-inline col mb-1">
            {% for upgrade in upgrades %}
                <li class="list-inline-item">
                    {{upgrade.get_type_display|get_icon}}
                    {% if upgrade.type2 %}
                    {{upgrade.get_type2_display|get_icon}}
                    {% endif %}
                    {{upgrade}}
                </li>
            {% endfor %}
            </ul>
        </div>
        {% endfor %}
    </div>
</div>


<div class="row">
    <div class="col">
        {% for ship in pilot.pilotship_set.all %}
        <div class="row mb-2">
                <div class="col-3">
                    <span class="font-weight-light {{ship.threat|threatbar}}">
                            {{ship.threat|threatbar|safe}}
                        </span>
                    <h5>{{ship.ship.name}} <i class="xw-ship xw-ship-{{ship.ship.css_name}}"></i>
                    </h5>
                    <span>Initiative {{ship.initiative}}</span>
                </div>
        </div>

        <div class="row">
            <div class="col">
                <h6>Unlocked Slots</h6>
            </div>
        </div>

        <div class="row no-gutters mb-3">
            {% regroup ship.unlocked.all by threat as threat_slots %}

            {% for threat, slots in threat_slots %}
            <div class="col-2">
                <ul class="list-group">
                    <li class="list-group-item"><strong class="font-weight-light threat|threatbar">{{threat|threatbar|safe}}</strong></li>
                    {% for slot in slots %}
                    <li class="list-group-item">{{slot.get_type_display}} [{{slot.cost}}]</li>
                    {% endfor %}
                </ul>
            </div>
            {% endfor %}

        </div>
        {% endfor %}
    </div>
</div>

<div class="row">
    <div class="col">
        <h5>Achievements</h5>
        <ul class="list-group col">
        {% for event in achievements %}
            <li class="list-group-item">{{event.event}} <span class="badge badge-primary badge-pill">x{{event.count}}</span></li>
        {% endfor %}
        </ul>

    </div>

</div>

{% endblock %}