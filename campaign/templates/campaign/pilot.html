{% extends 'base.html' %}

{% load crispy_forms_tags %}
{% load xwf_extras %}
{% load static %}

{% block content %}

<h3>{{pilot.callsign}}{% if pilot.user.username != pilot.callsign %} ({{pilot.user}}){% endif %}</h3>
<h5>Campaign: <a href="{% url 'game:campaign' pilot.campaign.id %}">{{pilot.campaign}}</a></h5>

<div class='row mb-3' id='pilot-stats'>
    <div class='col-sm-4'>
        {% include './includes/pilot_ship.html' with ship=pilot.active_ship slots=pilot.slots %}
    </div>
</div>

<div class="row mb-3">
    <ul class="nav nav-tabs" id="sheet-nav" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="upgrade-tab" data-bs-toggle="tab"
                  data-bs-target="#upgrades" type="button" role="tab"
                  aria-controls="upgrades" aria-selected="true">Upgrades</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="available-tab" data-bs-toggle="tab"
                  data-bs-target="#available" type="button" role="tab"
                  aria-controls="available" aria-selected="false">Available</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="stats-tab" data-bs-toggle="tab"
                  data-bs-target="#stats" type="button" role="tab"
                  aria-controls="stats" aria-selected="false">Statistics</button>
        </li>
    </ul>
</div>

<div class="row mb-3 tab-content d-flex flex-wrap">
    <div class="tab-pane active" role="tabpanel" aria-labelledby="upgrade-tab" id="upgrades">
        <div class="container">
            <div class="row mb-5 d-flex flex-wrap ">
            {% for gu in pilot.upgrades.all %}
            {% ifchanged gu.card.type %}
            </div>
            <div class="row mb-5 d-flex flex-wrap">
            {% endifchanged %}
            {% include './includes/upgrade_card.html' with upgrade=gu.card cost=gu.cost status=gu.status %}
            {% endfor %}
            </div>
        </div>
    </div>

    <div class="tab-pane" role="tabpanel" aria-labelledby="available-tab" id="available">
        <div class="container">
            <div class="row mb-3">
                {% crispy update update.helper %}
            </div>

            <div class="row mb-5 d-flex flex-wrap">
            {% for au in pilot.available_upgrades.all %}
            {% ifchanged au.type %}
            </div>
            <div class="row mb-5 d-flex flex-wrap">
            {% endifchanged %}
            {% include './includes/upgrade_card.html' with upgrade=au cost=au|get_cost:pilot.campaign.rulebook.upgrade_logic %}
            {% endfor %}
            </div>
        </div>
    </div>

    <div class="tab-pane" role="tabpanel" aria-labelledby="stats-tab" id="stats">
        <div class="container">
            <div class="row mb-3 d-flex flex-wrap">
                <p>Missions Flown: {{pilot.sessions.count}}</p>
                <p>XP Earned: <i class="xwing-miniatures-font xwing-miniatures-font-squad-point-cost"></i>{{pilot.total_xp}}</p>

                <p>XP Spent: <i class="xwing-miniatures-font xwing-miniatures-font-squad-point-cost"></i>{{pilot.spent_ships}} Ships,
                           <i class="xwing-miniatures-font xwing-miniatures-font-squad-point-cost"></i>{{pilot.spent_initiative}} Initiative,
                           <i class="xwing-miniatures-font xwing-miniatures-font-squad-point-cost"></i>{{pilot.spent_upgrades}} Upgrades
                       </p>
                <p>XP Available: <i class="xwing-miniatures-font xwing-miniatures-font-squad-point-cost"></i>{{remaining}}</p>
            </div>
        </div>
    </div>


{% endblock content %}

{% block extrajs %}
    <script src="{% static 'js/pilot_upgrade.js' %}"></script>
{% endblock extrajs %}
