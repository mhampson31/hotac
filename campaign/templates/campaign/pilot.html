{% extends 'base.html' %}

{% load crispy_forms_tags %}
{% load xwf_extras %}
{% load static %}

{% block content %}

<h3>{{pilot.callsign}}</h3>

<div class='row' id='pilot-stats'>
    <p>Player: {{pilot.user}}</p>
    <p>Campaign: <a href="{% url 'game:campaign' pilot.campaign.id %}">{{pilot.campaign}}</a></p>
    <p>Missions Flown: {{pilot.sessions.count}}</p>
    <p>Initiative {{pilot.initiative}}</p>
    <p>XP Earned: <i class="xwing-miniatures-font xwing-miniatures-font-squad-point-cost"></i>{{pilot.total_xp}}</p>
    <p>XP Spent: <i class="xwing-miniatures-font xwing-miniatures-font-squad-point-cost"></i>{{pilot.spent_ships}} Ships,
               <i class="xwing-miniatures-font xwing-miniatures-font-squad-point-cost"></i>{{pilot.spent_initiative}} Initiative,
               <i class="xwing-miniatures-font xwing-miniatures-font-squad-point-cost"></i>{{pilot.spent_upgrades}} Upgrades
           </p>
    <p>XP Available: <i class="xwing-miniatures-font xwing-miniatures-font-squad-point-cost"></i>{{remaining}}</p>
</div>

<div class="row mb-1">
    <h6 class='col'>
        <a href="{% url 'chassis' chassis_slug=pilot.active_ship.chassis.slug %}">{{pilot.active_ship.name}} <i class="xw-ship xw-ship-{{pilot.active_ship.css_name}}"></i></a>
    </h6>
</div>

<div class="row mb-3">
    <ul class="col list-group list-group-horizontal">
        {% for slot in pilot.slots %}
        <li class="list-group-item">{{slot.label|get_icon}}<li>
        {% endfor %}
    </ul>
</div>

<div class="row mb-3">
    <ul class="nav nav-tabs" id="sheet-nav" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="upgrade-tab" data-bs-toggle="tab"
                  data-bs-target="#upgrades" type="button" role="tab"
                  aria-controls="upgrades" aria-selected="true">Upgrades</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="available-tab" data-bs-toggle="tab"
                  data-bs-target="#available" type="button" role="tab"
                  aria-controls="available" aria-selected="false">Available</button>
        </li>
    </ul>
</div>

<div class="row mb-3 tab-content d-flex flex-wrap">
    <div class="tab-pane active" role="tabpanel" aria-labelledby="upgrade-tab" id="upgrades">
        <div class="container">
            <div class="row mb-3 d-flex flex-wrap ">
            {% for gu in pilot.upgrades.all %}
            {% ifchanged gu.card.type %}
            </div>
            <div class="row mb-3 d-flex flex-wrap">
            {% endifchanged %}
            {% include './includes/upgrade_card.html' with upgrade=gu.card upgrade_logic=pilot.campaign.rulebook.upgrade_logic status=gu.status %}
            {% endfor %}
            </div>
        </div>
    </div>

    <div class="tab-pane" role="tabpanel" aria-labelledby="available-tab" id="available">
        <div class="container">
            <div class="row mb-3">
                {% crispy update update.helper %}
            </div>

            <div class="row mb-3 d-flex flex-wrap">
            {% for au in pilot.available_upgrades.all %}
            {% ifchanged au.type %}
            </div>
            <div class="row mb-3 d-flex flex-wrap">
            {% endifchanged %}
            {% include './includes/upgrade_card.html' with upgrade=au upgrade_logic=pilot.campaign.rulebook.upgrade_logic %}
            {% endfor %}
            </div>
        </div>
    </div>

{% endblock content %}

{% block extrajs %}
    <script src="{% static 'js/pilot_upgrade.js' %}"></script>
{% endblock extrajs %}
